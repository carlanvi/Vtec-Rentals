<!DOCTYPE html>
<html>
<head>
  <title>Admin Dashboard</title>
  <style>
    .admin-container { padding: 20px; }
    .content-section { display: none; }
    .content-section.active { display: block; }
    .gallery-grid { display: flex; flex-wrap: wrap; gap: 10px; }
    .gallery-grid div { width: 200px; }
    img { width: 100%; height: auto; }
    .remove-btn { color: red; position: absolute; top: 5px; right: 5px; }
    .admin-nav { display: flex; gap: 10px; margin-bottom: 20px; }
  </style>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
</head>
<body>
  <div class="admin-container">
    <div class="admin-nav">
      <button onclick="showSection('galleryPage')">GALLERY</button>
      <button onclick="showSection('reservationsPage')">RESERVATIONS</button>
    </div>

    <!-- Gallery Page -->
    <div id="galleryPage" class="admin-container content-section active">
      <h2>GALLERY</h2>
      <input type="file" id="imageInput"><br><br>
      <input type="text" id="itemName" placeholder="Item Name"><br><br>
      <input type="number" id="itemPrice" placeholder="Item Price"><br><br>
      <input type="text" id="itemCategory" placeholder="Category"><br><br>
      <button onclick="uploadPhoto()">Upload</button>

      <div id="adminGallery" style="margin-top: 20px;"></div>
    </div>

    <!-- Reservations Page -->
    <div id="reservationsPage" class="admin-container content-section">
      <h2>RESERVATIONS</h2>
      <div id="orderList"></div>
      <button onclick="promptClearOrders()">Clear All Orders</button>
    </div>
  </div>

  <script>
    // Firebase config
    const firebaseConfig = {
  apiKey: "AIzaSyACGG7Wf-TwdoeAxjqxQ8iIdpmPegEtunY",
  authDomain: "vtec-rentals.firebaseapp.com",
  projectId: "vtec-rentals",
  storageBucket: "vtec-rentals.firebasestorage.app",
  messagingSenderId: "278776721799",
  appId: "1:278776721799:web:f70b283d8313cd84eca322"
};
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    function showSection(sectionId) {
      document.querySelectorAll('.content-section').forEach(section =>
        section.classList.remove('active')
      );
      document.getElementById(sectionId).classList.add('active');

      if (sectionId === 'reservationsPage') {
        loadOrders();
      }
    }

    function uploadPhoto() {
      const file = document.getElementById('imageInput').files[0];
      const name = document.getElementById('itemName').value;
      const price = parseFloat(document.getElementById('itemPrice').value);
      const category = document.getElementById('itemCategory').value;

      if (!file || !name || isNaN(price)) {
        alert("Fill all fields correctly.");
        return;
      }

      const reader = new FileReader();
      reader.onloadend = function () {
        const url = reader.result;
        db.collection("gallery").add({
          name,
          price,
          category,
          url,
          timestamp: firebase.firestore.FieldValue.serverTimestamp()
        }).then(() => {
          alert("Uploaded!");
          loadGallery();
        });
      };
      reader.readAsDataURL(file);
    }

    function removePhoto(docId) {
      if (!confirm("Delete this item?")) return;
      db.collection("gallery").doc(docId).delete().then(() => {
        alert("Deleted");
        loadGallery();
      });
    }

    function updateItem(docId) {
      const newName = document.getElementById(`name-${docId}`).value.trim();
      const newPrice = parseFloat(document.getElementById(`price-${docId}`).value);

      if (!newName || isNaN(newPrice)) {
        alert("Please enter valid name and price.");
        return;
      }

      db.collection('gallery').doc(docId).update({
        name: newName,
        price: newPrice
      })
      .then(() => alert("Item updated."))
      .catch(err => alert("Update failed: " + err.message));
    }

    function loadGallery() {
      const galleryContainer = document.getElementById('adminGallery');
      galleryContainer.innerHTML = '';

      db.collection('gallery').orderBy('timestamp', 'desc').onSnapshot((querySnapshot) => {
        galleryContainer.innerHTML = '';
        const categories = {};

        querySnapshot.forEach((doc) => {
          const data = doc.data();
          const category = data.category || 'Uncategorized';

          if (!categories[category]) categories[category] = [];
          categories[category].push({ ...data, docId: doc.id });
        });

        for (const category in categories) {
          galleryContainer.innerHTML += `
            <div class="gallery-category">
              <h3>${category}</h3>
              <div class="gallery-wrapper">
                <div class="gallery-grid" id="gallery-${category}"></div>
              </div>
            </div>
          `;

          const categoryContainer = document.getElementById(`gallery-${category}`);
          categories[category].forEach(item => {
            categoryContainer.innerHTML += `
              <div style="position: relative; padding-bottom: 10px;">
                <img src="${item.url}" alt="${item.name}">
                <button class="remove-btn" onclick="removePhoto('${item.docId}')">X</button>
                <div style="margin-top: 10px;">
                  <input type="text" value="${item.name}" id="name-${item.docId}" placeholder="Name" style="width: 100%;" />
                  <input type="number" value="${item.price}" id="price-${item.docId}" placeholder="Price" style="width: 100%; margin-top: 5px;" />
                  <button onclick="updateItem('${item.docId}')">Save</button>
                </div>
              </div>
            `;
          });
        }
      });
    }

    function loadOrders() {
      const orderList = document.getElementById('orderList');
      orderList.innerHTML = '<p>Loading orders...</p>';

      db.collection("orders").orderBy("timestamp", "desc").get()
        .then(snapshot => {
          if (snapshot.empty) {
            orderList.innerHTML = '<p>No reservations found.</p>';
            return;
          }

          orderList.innerHTML = '';
          snapshot.forEach(doc => {
            const order = doc.data();
            const div = document.createElement('div');
            div.style.border = '1px solid #ccc';
            div.style.padding = '10px';
            div.style.marginBottom = '10px';

            div.innerHTML = `
              <strong>Name:</strong> ${order.name || 'N/A'}<br>
              <strong>Dates:</strong> ${order.startDate} ${order.startTime} to ${order.endDate} ${order.endTime}<br>
              <strong>Total:</strong> $${order.total.toFixed(2)}<br>
              <strong>Items:</strong>
              <ul>
                ${(order.items || []).map(item => `<li>${item.name} - Qty: ${item.quantity} - $${item.totalPrice.toFixed(2)}</li>`).join('')}
              </ul>
            `;

            orderList.appendChild(div);
          });
        })
        .catch(error => {
          orderList.innerHTML = `<p>Error loading orders: ${error.message}</p>`;
        });
    }

    function promptClearOrders() {
      const confirmation = prompt("Type CONFIRM to delete all reservation orders:");
      if (confirmation !== "CONFIRM") return;

      db.collection("orders").get().then(snapshot => {
        const batch = db.batch();
        snapshot.forEach(doc => batch.delete(doc.ref));
        return batch.commit();
      }).then(() => {
        alert("All orders cleared.");
        loadOrders();
      }).catch(error => {
        console.error("Error clearing orders: ", error);
        alert("Failed to clear orders.");
      });
    }

    // Load gallery on startup
    window.onload = function () {
      loadGallery();
    };
  </script>
</body>
</html>
